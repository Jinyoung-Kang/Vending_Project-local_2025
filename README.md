# 네트워크 프로그래밍 텀 프로젝트: 분산 자판기 관리 시스템

본 프로젝트는 '네트워크 프로그래밍' 강의의 텀 프로젝트로 개발된 고가용성 분산 자판기 관리 시스템입니다. Python을 기반으로 다수의 GUI 클라이언트, 실시간으로 동기화되는 3중 서버(주 서버, 동기화 서버, 백업 서버), 그리고 웹 기반 관리 대시보드를 구현하여 안정적이고 확장 가능한 시스템을 구축하는 것을 목표로 합니다.

<br>

## 📜 주요 기능

### 💻 클라이언트 (자판기 GUI)
* 직관적인 GUI: `Tkinter`를 사용하여 실제 자판기와 유사한 사용자 경험을 제공합니다.
* 실시간 상호작용: 투입 금액에 따라 구매 가능한 음료 버튼이 실시간으로 활성화/비활성화되며, 재고가 소진되면 '품절'로 표시됩니다.
* 다양한 화폐 단위 지원: 10원, 50원, 100원, 500원 동전 및 1,000원 지폐 투입이 가능하며, 최대 투입 한도(총 7,000원, 지폐 5,000원)가 적용됩니다.
* 구매 취소 기능: `Stack` 자료구조를 활용하여 가장 최근의 구매 내역을 취소하고 재고와 잔액을 이전 상태로 복구할 수 있습니다.

### 🔐 관리자 기능 (GUI & Web)
* 강력한 보안: 관리자 비밀번호는 SHA256 해시로 안전하게 저장되며, 특수문자와 숫자를 포함한 8자리 이상의 복잡도 규칙이 적용됩니다.
* 오프라인 관리: 클라이언트 GUI 내에서 네트워크 연결 없이도 재고 보충, 현금 수금, 음료 정보(이름/가격) 수정 등 오프라인 작업이 가능합니다.
* 통합 매출 관리: 로컬 클라이언트에서는 암호화된 파일로 일별/월별 매출을 조회하고, 서버의 웹 대시보드에서는 모든 자판기의 통합 매출 현황을 실시간으로 확인할 수 있습니다.
* 중앙 재고 현황: 웹 대시보드를 통해 전체 자판기의 재고를 한눈에 파악할 수 있습니다.

### 🌐 서버 및 네트워크
* 고가용성 아키텍처: 주 서버(Primary) 장애 시, Heartbeat 체크를 통해 이를 감지한 백업 서버(Backup)가 자동으로 주 서버 역할을 이어받는 Failover 기능을 구현하여 서비스 중단을 최소화합니다.
* 실시간 데이터 동기화: 주 서버에서 처리된 모든 데이터는 Raw Socket과 직접 정의한 프로토콜을 통해 다른 서버(동기화 서버, 백업 서버)에 UDP 브로드캐스트 방식으로 실시간 전파되어 데이터 정합성을 보장합니다.
* 비동기 처리: 클라이언트의 데이터는 별도의 네트워크 스레드와 `Queue`를 통해 비동기적으로 서버에 전송되므로, 네트워크 지연이 발생해도 GUI 프로그램이 멈추지 않습니다.
* 데이터 암호화: `cryptography` 라이브러리를 사용하여 클라이언트-서버 간 통신 데이터와 로컬에 저장되는 모든 매출 파일을 대칭키 방식으로 암호화하여 보안을 강화했습니다.

<br>

## 🛠️ 기술 스택

* Language: `Python 3.11`
* GUI: `Tkinter`
* Database: `SQLite 3`
* Core Libraries: `socket`, `threading`, `queue`, `hashlib`, `sqlite3`, `json`, `struct`
* Security: `cryptography` (Fernet Symmetric Encryption)
* Web Server: `http.server`, `socketserver`

<br>

## ⚙️ 시스템 아키텍처

본 시스템은 클라이언트, 주 서버(Server 1), 동기화 서버(Server 2), 백업 서버(Backup_Server)의 네 가지 핵심 요소로 구성됩니다.

1.  데이터 전송 (Client → Server 1): 다수의 클라이언트는 판매 및 재고 데이터를 암호화하여 TCP 소켓을 통해 주 서버(Server 1)로 전송합니다.
2.  데이터 처리 및 동기화 요청 (Server 1): 주 서버는 데이터를 복호화하여 자신의 DB에 저장한 뒤, 동일 데이터를 내부 동기화 큐(Queue)에 추가합니다.
3.  데이터 전파 (Server 1 → All Servers): Raw Socket 처리 스레드가 큐에서 데이터를 가져와 IP/UDP 헤더를 포함한 커스텀 패킷을 생성하고, 이를 네트워크에 브로드캐스트하여 다른 서버들에게 전파합니다.
4.  데이터 수신 (Server 2, Backup_Server): 동기화 서버와 백업 서버는 브로드캐스트된 패킷을 수신하여 각자의 DB를 업데이트함으로써 데이터 일관성을 유지합니다.
5.  상태 감시 (Backup_Server → Server 1): 백업 서버는 10초마다 주 서버로 TCP 접속(Heartbeat)을 시도하여 생존 여부를 확인하고, 장애 발생 시 즉시 Failover를 수행합니다.

<br>

## 🚀 설치 및 실행 방법

### 1. 필요 라이브러리 설치

```bash
pip install cryptography
````

### 2\. 실행 순서

각 컴포넌트는 별도의 터미널에서 실행해야 합니다. 반드시 아래 순서를 지켜주세요.

① 동기화 서버 (Server 2) 실행

```bash
python network/server/server2.py
```

② 백업 서버 (Backup Server) 실행

> ※ 주의: Raw Socket 사용을 위해 관리자(root/sudo) 권한으로 실행해야 합니다.

```bash
sudo python network/server/backup_server.py
```

③ 주 서버 (Server 1) 실행

> ※ 주의: Raw Socket 사용을 위해 관리자(root/sudo) 권한으로 실행해야 합니다.

```bash
sudo python network/server/server.py
```

④ 클라이언트 (자판기) 실행

> 필요에 따라 여러 개의 클라이언트를 동시에 실행할 수 있습니다.

```bash
python gui/main_window.py
```

> 다중 클라이언트 테스트 시, `gui/main_window.py` 파일의 `self.vm = VendingMachine("VM-001")` 부분의 ID를 `"VM-002"`, `"VM-003"` 등으로 수정하여 실행하세요.

### 3\. 웹 관리 대시보드 접속

서버 실행 후, 웹 브라우저에서 아래 주소로 접속하세요.

  * 주 서버 동작 시: `http://127.0.0.1:8000/admin.html`
  * 백업 서버 Failover 시: `http://127.0.0.1:8001/admin.html`

\<br\>

## 💡 핵심 구현 사항

프로젝트 요구사항을 만족시키기 위해 다음과 같은 기술들을 중점적으로 구현했습니다.

  * 자료구조의 직접 구현 및 활용

      * Linked List: 음료의 재고와 정보를 관리하기 위해 `BeverageLinkedList`를 직접 구현했습니다.
      * Stack: '최근 구매 취소' 기능을 LIFO(Last-In, First-Out) 원칙에 따라 구현했습니다.
      * Queue: GUI의 반응성을 해치지 않으면서 네트워크 데이터를 순차적으로 처리하기 위해 비동기 전송 큐를 활용했습니다.
      * Tree: 음료 카테고리를 계층적으로 표현하는 트리 구조를 구현했습니다.

  * 고급 네트워크 프로그래밍

      * Raw Socket: 서버 간 데이터 동기화를 위해 IP 및 UDP 헤더를 직접 제어하는 Raw Socket을 사용하여 커스텀 프로토콜을 구현했습니다.
      * 멀티 스레딩: 클라이언트 요청 처리, 데이터 동기화, Heartbeat 체크, 웹 서버 등 다양한 기능을 동시에 안정적으로 수행하기 위해 `threading` 모듈을 적극 활용했습니다.

  * 알고리즘

      * 정렬(Sort) 및 탐색(Search): 음료 리스트를 이름 또는 가격순으로 정렬하고, 특정 음료를 찾는 기능을 구현했습니다.

<!-- end list -->

```
```
